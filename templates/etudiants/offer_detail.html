<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ announcement.title }} - Photo Gallery</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
.quiz-btn-disabled {
    background-color: #6c757d !important;
    border-color: #6c757d !important;
    color: #fff !important;
    cursor: not-allowed !important;
    opacity: 0.65;
}

.quiz-btn-disabled:hover {
    background-color: #6c757d !important;
    border-color: #6c757d !important;
}

.quiz-btn {
    cursor: pointer;
}
</style>
    <style>
        .dropdown-enter {
            opacity: 0;
            transform: translateY(-10px);
        }
        .dropdown-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 200ms, transform 200ms;
        }
        .dropdown-exit {
            opacity: 1;
        }
        .dropdown-exit-active {
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 200ms, transform 200ms;
        }
        
        /* Heart icon styles */
        .heart-icon {
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            padding: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .heart-icon:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 1);
        }
        
        .heart-icon.favorited {
            color: #ef4444;
        }
        
        .heart-icon.not-favorited {
            color: #9ca3af;
        }
        
        .heart-icon:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Staff delete button styles */
        .staff-delete-button {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .staff-delete-button:hover {
            background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.4);
        }
        
        .staff-delete-button:active {
            transform: translateY(0);
        }

        /* Toast notification styles */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast {
            min-width: 300px;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: white;
            font-family: Arial, sans-serif;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease-in-out;
            position: relative;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.success {
            background: linear-gradient(135deg, #28a745, #20c997);
        }

        .toast.error {
            background: linear-gradient(135deg, #dc3545, #e74c3c);
        }

        .toast.warning {
            background: linear-gradient(135deg, #ffc107, #ffb300);
            color: #333;
        }

        .toast.info {
            background: linear-gradient(135deg, #17a2b8, #00bcd4);
        }

        .toast-icon {
            font-size: 18px;
            font-weight: bold;
        }

        .toast-close {
            position: absolute;
            top: 5px;
            right: 10px;
            background: none;
            border: none;
            color: inherit;
            font-size: 16px;
            cursor: pointer;
            opacity: 0.7;
        }

        .toast-close:hover {
            opacity: 1;
        }

        .toast-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 0 0 8px 8px;
            animation: progress 5s linear;
        }

        @keyframes progress {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        /* Enhanced Photo Gallery Styles */
        .gallery-main-image {
            transition: all 0.4s ease-in-out;
            transform: scale(1);
        }
        
        .gallery-main-image.loading {
            opacity: 0.7;
            transform: scale(0.98);
        }
        
        .gallery-thumbnail {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 3px solid transparent;
            filter: brightness(0.8);
        }
        
        .gallery-thumbnail:hover {
            transform: scale(1.05);
            filter: brightness(1);
            border-color: #60a5fa;
        }
        
        .gallery-thumbnail.active {
            transform: scale(1.08);
            border-color: #3b82f6;
            filter: brightness(1);
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
        }
        
        .gallery-nav-btn {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .gallery-nav-btn:hover {
            background: rgba(0, 0, 0, 0.8);
            transform: scale(1.1);
        }
        
        .gallery-counter {
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .thumbnail-scroll-container {
            scroll-behavior: smooth;
            scrollbar-width: thin;
            scrollbar-color: #3b82f6 #f1f5f9;
        }
        
        .thumbnail-scroll-container::-webkit-scrollbar {
            height: 6px;
        }
        
        .thumbnail-scroll-container::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        
        .thumbnail-scroll-container::-webkit-scrollbar-thumb {
            background: #3b82f6;
            border-radius: 3px;
        }
        
        .thumbnail-scroll-container::-webkit-scrollbar-thumb:hover {
            background: #2563eb;
        }
        
        /* Loading animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading-pulse {
            animation: pulse 2s infinite;
        }
        
        /* Fade in animation */
        @keyframes fadeIn {
            from { 
                opacity: 0; 
                transform: translateY(10px);
            }
            to { 
                opacity: 1; 
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Zoom effect on main image hover */
        .gallery-main-container:hover .gallery-main-image {
            transform: scale(1.02);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .gallery-thumbnail {
                min-width: 60px;
                height: 60px;
            }
        }

        /* Simple Profile Cube Styles */
        .profile-cube {
            transition: all 0.3s ease;
        }
        
        .profile-cube:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        }
        
        .profile-avatar {
            transition: all 0.3s ease;
        }
        
        .profile-cube:hover .profile-avatar {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- Toast container -->
    <div class="toast-container" id="toastContainer"></div>
    {% csrf_token %}

<nav class="w-full sticky top-0 z-50 bg-white shadow">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
            <div class="flex items-center">
                <a href="{% url 'pages:homepage' %}" class="flex items-center">
                    <img src="https://img.freepik.com/vecteurs-premium/creation-logo-education-scolaire-maison-modele-logo-logement-etudiant_825834-932.jpg"
                        alt="Talib Space Logo" class="h-12 w-auto mr-3">
                    <span class="text-2xl font-extrabold text-gray-800">talib space</span>
                    <span class="ml-4 text-gray-600">| roomate founder</span>
                </a>
            </div>

            <div class="hidden md:flex items-center space-x-8">
                <a href="{% url 'pages:offers' %}" class="text-gray-600 hover:text-blue-500 transition duration-300">Offers</a>
                <a href="{% url 'pages:howworks' %}" class="text-gray-600 hover:text-blue-500 transition duration-300">How Talib Space Works</a>
                <a href="{% url 'pages:testo' %}" class="text-gray-600 hover:text-blue-500 transition duration-300">Testimonials</a>
            </div>

            {% if user.is_authenticated %}
                <!-- Logged-in User Menu -->
                <div class="flex items-center space-x-4">
                    <div class="relative">
                        <button id="user-menu-button" type="button" class="flex items-center space-x-2 focus:outline-none">
                            <span class="text-gray-600">{{ user.name }}</span>
                            <div class="w-8 h-8 rounded-full bg-gray-200 flex items-center justify-center overflow-hidden">
                                {% if user.profile_picture %}
                                    <img src="{{ user.profile_picture.url }}" alt="Profile Photo" class="w-full h-full object-cover">
                                {% else %}
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                    </svg>
                                {% endif %}
                            </div>
                        </button>
                        
                        <!-- Dropdown menu -->
                        <div id="user-dropdown" class="hidden absolute right-0 mt-2 w-48 origin-top-right bg-white rounded-md shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none transition-all duration-200 transform opacity-0 scale-95">
                            {% if user.is_staff %}
                                <!-- Menu pour les utilisateurs staff -->
                                <div class="py-1" role="none">
                                    <a href="{% url 'pages:admin_dashboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">Dashboard</a>
                                    <a href="{% url 'contact:reports_dashboard' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">Reports</a>
                                    <a href="{% url 'pages:profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">Profile</a>
                                    <a href="{% url 'pages:settings' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">Settings</a>

                                    <div class="border-t border-gray-100"></div>
                                    <a href="{% url 'pages:logout' %}" class="block px-4 py-2 text-sm text-red-700 hover:bg-gray-100 transition duration-150">Sign out</a>
                                </div>
                            {% else %}
                                <!-- Menu pour les utilisateurs normaux -->
                                <div class="py-1" role="none">
                                    <a href="{% url 'etudiants:my_announcements' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">My Announcements</a>
                                    <a href="{% url 'etudiants:my_favorites' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">My Favorites</a>
                                    <a href="{% url 'pages:profile' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">Profile</a>
                                    <a href="{% url 'inbox' %}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 transition duration-150">inbox</a>
                                    
                                    <div class="border-t border-gray-100"></div>
                                    <a href="{% url 'pages:logout' %}" class="block px-4 py-2 text-sm text-red-700 hover:bg-gray-100 transition duration-150">Sign out</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% else %}
                <!-- Visitor Menu -->
                <div class="flex items-center space-x-4">
                    <a href="{% url 'pages:login' %}" class="px-4 py-2 border border-blue-500 text-blue-500 rounded-md hover:bg-blue-50 transition duration-300">Sign In</a>
                    <a href="{% url 'pages:register' %}" class="px-4 py-2 border border-green-500 text-green-500 rounded-md hover:bg-green-50 transition duration-300">Create Account</a>
                </div>
            {% endif %}

            <!-- Mobile menu button (visible on small screens) -->
            <div class="md:hidden flex items-center">
                <button class="mobile-menu-button">
                    <svg class="w-6 h-6 text-gray-500" fill="none" stroke-linecap="round" stroke-linejoin="round"
                        stroke-width="2" viewBox="0 0 24 24" stroke="currentColor">
                        <path d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>
</nav>

    {% if user.is_authenticated %}
    <!-- <a href="{% url 'inbox' %}" class="relative p-2 text-gray-600 hover:text-blue-600">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
      </svg> -->
      
      <!-- Unread message indicator -->
      {% if unread_message_count > 0 %}
      <span class="absolute top-0 right-0 inline-flex items-center justify-center h-5 w-5 rounded-full bg-red-600 text-xs font-medium text-white">
        {{ unread_message_count }}
      </span>
      {% endif %}
    </a>
    {% endif %}

    <main>
        {% load static %}

        {% block content %}
        <div class="container mx-auto px-4 py-8">
            <div class="mb-6">
                <a href="{% url 'pages:offers' %}" class="inline-flex items-center text-blue-600 hover:text-blue-800">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                    </svg>
                    Back to Offers
                </a>
            </div>
            
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden">
                <div class="lg:flex">
                    <!-- Enhanced Photo Gallery Section -->
                    <div class="lg:w-3/5 xl:w-2/3">
                        {% if announcement.images.all %}
                            <div class="relative">
                                <!-- Main Image Display -->
                                <div class="gallery-main-container relative bg-gray-900 aspect-video overflow-hidden">
                                    {% for image in announcement.images.all %}
                                        <img src="{{ image.image.url }}" 
                                             alt="Announcement image {{ forloop.counter }}" 
                                             class="gallery-main-image w-full h-full object-cover {% if forloop.first %}block{% else %}hidden{% endif %}"
                                             data-image-index="{{ forloop.counter0 }}"
                                             id="main-image-{{ forloop.counter0 }}">
                                    {% endfor %}
                                    
                                    <!-- Image Counter -->
                                    <div class="gallery-counter absolute top-4 right-4 text-white px-4 py-2 rounded-full text-sm font-medium">
                                        <span id="current-image-number">1</span> / <span id="total-images">{{ announcement.images.all|length }}</span>
                                    </div>
                                    
                                    <!-- Navigation Arrows -->
                                    {% if announcement.images.all|length > 1 %}
                                        <button id="prev-image-btn" class="gallery-nav-btn absolute left-4 top-1/2 transform -translate-y-1/2 text-white p-3 rounded-full transition-all duration-200">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                            </svg>
                                        </button>
                                        <button id="next-image-btn" class="gallery-nav-btn absolute right-4 top-1/2 transform -translate-y-1/2 text-white p-3 rounded-full transition-all duration-200">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                            </svg>
                                        </button>
                                    {% endif %}
                                    
                                    <!-- Loading overlay -->
                                    <div id="image-loading" class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center hidden">
                                        <div class="loading-pulse text-white text-lg font-medium">Loading...</div>
                                    </div>
                                </div>
                                
                                <!-- Enhanced Thumbnail Gallery -->
                                {% if announcement.images.all|length > 1 %}
                                <div class="bg-gray-100 p-6">
                                    <h3 class="text-lg font-semibold text-gray-800 mb-4">All Photos ({{ announcement.images.all|length }})</h3>
                                    <div class="thumbnail-scroll-container flex space-x-4 overflow-x-auto pb-3">
                                        {% for image in announcement.images.all %}
                                            <div class="mr-4 flex-shrink-0">
                                                <img src="{{ image.image.url }}" 
                                                     alt="Thumbnail {{ forloop.counter }}" 
                                                     class="gallery-thumbnail w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg {% if forloop.first %}active{% endif %}"
                                                     data-thumbnail-index="{{ forloop.counter0 }}">
                                            </div>
                                        {% endfor %}
                                    </div>
                                    
                                    <!-- Gallery Info -->
                                    <div class="mt-4 text-sm text-gray-600">
                                        <p>üí° Click on thumbnails to view larger images. Use arrow keys or buttons to navigate.</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        {% else %}
                            <div class="w-full aspect-video bg-gray-200 flex items-center justify-center">
                                <div class="text-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                                    </svg>
                                    <span class="text-gray-500 text-lg">No images available</span>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Details Section -->
                    <div class="lg:w-2/5 xl:w-1/3 p-8 bg-gradient-to-br from-blue-50 to-indigo-50">
                        <div class="sticky top-8">
                            <div class="space-y-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ announcement.title }}</h1>
                                    <div class="flex items-center text-gray-600 mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                        <span>{{ announcement.city }}</span>
                                    </div>
                                    <div class="text-3xl font-bold text-blue-600">‚Ç¨{{ announcement.price }}/month</div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                        <span class="text-gray-700">Room Type: <strong>{{ announcement.get_room_type_display }}</strong></span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                        <span class="text-gray-700">Gender Preference: <strong>{{ announcement.get_gender_preference_display }}</strong></span>
                                    </div>
                                    <div class="flex items-center">
                                        <div class="w-2 h-2 bg-blue-500 rounded-full mr-3"></div>
                                        <span class="text-gray-700">Posted: <strong>{{ announcement.created_at|date:"F j, Y" }}</strong></span>
                                    </div>
                                </div>
                                
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Amenities</h3>
                                    <div class="flex flex-wrap gap-2">
                                        {% for amenity in announcement.get_amenities_list %}
                                        <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm">{{ amenity }}</span>
                                        {% empty %}
                                        <span class="text-gray-500">No amenities listed</span>
                                        {% endfor %}
                                    </div>
                                </div>
                                
                              <div class="pt-4">
                                    {% if user.is_authenticated %}
                                        {% if user == announcement.user %}
                                            <!-- Owner viewing their own announcement - only show info -->
                                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                                <div class="flex items-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-blue-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                    <span class="text-blue-800 text-sm font-medium">Votre Annonce</span>
                                                </div>
                                                <p class="text-blue-700 text-sm mt-1">Vous consultez votre propre annonce. Les boutons d'interaction ne sont pas disponibles.</p>
                                            </div>
                                        {% elif user.is_staff %}
                                            <!-- Staff Delete Button -->
                                            <div class="space-y-3">
                                                <button 
                                                    onclick="confirmStaffDelete({{ announcement.id }}, '{{ announcement.title|escapejs }}', '{{ announcement.user.name|escapejs }} {{ announcement.user.surname|escapejs }}', '{{ announcement.user.email|escapejs }}')"
                                                    class="staff-delete-button w-full flex items-center justify-center space-x-2 font-semibold py-4 px-6 rounded-xl transition-all duration-200">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                    </svg>
                                                    <span>Supprimer Annonce</span>
                                                </button>
                                                
                                                <!-- Staff Info -->
                                                <div class="bg-red-50 border border-red-200 rounded-lg p-3">
                                                    <div class="flex items-center">
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-600 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.664-.833-2.464 0L4.35 15.5c-.77.833.192 2.5 1.732 2.5z" />
                                                        </svg>
                                                        <span class="text-red-800 text-sm font-medium">Staff Action</span>
                                                    </div>
                                                    <p class="text-red-700 text-xs mt-1">En tant qu'administrateur, vous pouvez supprimer cette annonce.</p>
                                                </div>
                                            </div>
                                        {% else %}
                                            <!-- Regular User Buttons -->
                                            <div class="space-y-3">
                                                <!-- Quiz Button with Completion Logic -->
                                                <div class="quiz-section">
                                                    {% if quiz_completed %}
                                                        <button class="quiz-btn-disabled w-full flex items-center justify-center space-x-2 font-semibold py-4 px-6 rounded-xl transition-colors duration-200" disabled>
                                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                            </svg>
                                                            <span>Quiz D√©j√† Compl√©t√©</span>
                                                        </button>
                                                    {% else %}
                                                        <button id="start-quiz-btn" class="quiz-btn w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl transition-colors duration-200" onclick="startQuiz()">
                                                            ü•≥ Prendre le QUIZ
                                                        </button>
                                                    {% endif %}
                                                </div>
                                                
                                                <!-- Favorite button with heart icon -->
                                                <button 
                                                    class="heart-icon {% if announcement.id in user_favorites %}favorited{% else %}not-favorited{% endif %} w-full flex items-center justify-center space-x-2 border-2 border-red-600 text-red-600 hover:bg-red-50 font-semibold py-4 px-6 rounded-xl transition-colors duration-200"
                                                    onclick="toggleFavorite(this)"
                                                    data-announcement-id="{{ announcement.id }}"
                                                    aria-label="Toggle favorite"
                                                    style="background: transparent; border-radius: 12px; box-shadow: none; width: 100%; height: auto; padding: 16px 24px;">
                                                    
                                                    {% if announcement.id in user_favorites %}
                                                        <!-- Filled heart -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
                                                                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09
                                                                     C13.09 3.81 14.76 3 16.5 3
                                                                     19.58 3 22 5.42 22 8.5
                                                                     c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                                        </svg>
                                                        <span>Remove from Favorites</span>
                                                    {% else %}
                                                        <!-- Empty heart -->
                                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
                                                                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09
                                                                     C13.09 3.81 14.76 3 16.5 3
                                                                     19.58 3 22 5.42 22 8.5
                                                                     c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                                        </svg>
                                                        <span>Add to Favorites</span>
                                                    {% endif %}
                                                </button>
                                            </div>
                                        {% endif %}
                                    {% else %}
                                        <!-- Not Authenticated -->
                                        <div class="space-y-3">
                                            <div class="quiz-section">
                                                <button class="quiz-btn w-full flex items-center justify-center space-x-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-4 px-6 rounded-xl transition-colors duration-200" onclick="loginRequired()">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                                                    </svg>
                                                    <span>Se connecter pour prendre le quiz</span>
                                                </button>
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Description Section -->
                <div class="p-6 border-t border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800 mb-4">Description</h2>
                    <div class="prose max-w-none text-gray-700">
                        {{ announcement.description|linebreaks }}
                    </div>
                </div>
                
                <!-- Contact Section with Profile Cube -->
                <div id="contact-section" class="p-6 bg-gray-50 border-t border-gray-200">
                    <h2 class="text-xl font-semibold text-gray-800 mb-6">Contact Information</h2>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Contact Information (Left Side) -->
                        <div class="lg:col-span-2">
                            <div class="bg-white p-6 rounded-lg shadow-sm">
                                <div class="flex items-center mb-4">
                                    <div class="bg-blue-100 rounded-full p-3 mr-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-gray-800">{{ announcement.user.name }} {{ announcement.user.surname }}</h3>
                                        <p class="text-gray-600 text-sm">Posted {{ announcement.created_at|timesince }} ago</p>
                                    </div>
                                </div>
                                
                                <div class="space-y-3">
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                        </svg>
                                        <a href="mailto:{{ announcement.user.email }}" class="text-blue-600 hover:underline">{{ announcement.user.email }}</a>
                                    </div>
                                    
                                    {% if announcement.user.profile.phone %}
                                    <div class="flex items-center">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                        </svg>
                                        <span>{{ announcement.user.profile.phone }}</span>
                                    </div>
                                    {% endif %}
                                </div>
                                
                                {% if user.is_authenticated and user != announcement.user %}
                                <div class="mt-6">
                                  <a href="{% url 'start_conversation' announcement.id %}" 
                                     class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                                    </svg>
                                    Contact Owner
                                  </a>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        
                        <!-- User Profile Cube (Right Side) -->
                        <div class="lg:col-span-1">
                            <div class="profile-cube bg-white rounded-lg shadow-sm border border-gray-200 p-6 text-center">
                                <!-- Profile Avatar -->
                                <div class="mb-4">
                                    <div class="profile-avatar w-16 h-16 mx-auto rounded-full bg-gray-100 flex items-center justify-center overflow-hidden">
                                        {% if announcement.user.profile_picture %}
                                            <img src="{{ announcement.user.profile_picture.url }}" alt="Profile Photo" class="w-full h-full object-cover">
                                        {% else %}
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                                            </svg>
                                        {% endif %}
                                    </div>
                                </div>
                                
                                <!-- User Name -->
                                <h3 class="text-lg font-semibold text-gray-900 mb-2">
                                    {{ announcement.user.name }} {{ announcement.user.surname }}
                                </h3>
                                
                                <!-- Profile Status Badge -->
                                <div class="mb-4">
                                    {% if announcement.user.profile_status == 'posting' %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                                            <svg class="w-2 h-2 mr-1" fill="currentColor" viewBox="0 0 8 8">
                                                <circle cx="4" cy="4" r="3"/>
                                            </svg>
                                            Has Posted Announcement
                                        </span>
                                    {% else %}
                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                            <svg class="w-2 h-2 mr-1" fill="currentColor" viewBox="0 0 8 8">
                                                <circle cx="4" cy="4" r="3"/>
                                            </svg>
                                            Looking for Offers
                                        </span>
                                    {% endif %}
                                </div>
                                
                                <!-- User Description -->
                                <div class="text-sm text-gray-600">
                                    {% if announcement.user.description %}
                                        <div class="max-h-20 overflow-y-auto">
                                            {{ announcement.user.description|truncatewords:20 }}
                                        </div>
                                    {% else %}
                                        <p class="italic text-gray-400">No description available from this user.</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endblock %}
    </main>

    <!-- Quiz Modal -->
    <div id="quiz-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <!-- Quiz Header -->
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-bold text-gray-800">Quiz de compatibilit√©</h3>
                <button id="close-quiz" class="text-gray-500 hover:text-gray-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Quiz Content -->
            <div class="p-6">
                <div id="quiz-progress" class="mb-6">
                    <div class="w-full bg-gray-200 rounded-full h-2.5">
                        <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                    <p id="progress-text" class="text-sm text-gray-600 mt-2">Question 1/5</p>
                </div>
                
                <div id="quiz-container">
                    <!-- Les questions seront inject√©es ici dynamiquement -->
                </div>
                
                <div class="mt-6 flex justify-between">
                    <button id="prev-quiz-btn" class="px-4 py-2 text-gray-600 hover:text-gray-800 hidden">
                        <i class="fas fa-arrow-left mr-2"></i> Pr√©c√©dent
                    </button>
                    <button id="next-quiz-btn" class="ml-auto px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition">
                        Suivant <i class="fas fa-arrow-right ml-2"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Staff Delete Confirmation Modal -->
    <div id="staff-delete-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md mx-4">
            <div class="p-6">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.664-.833-2.464 0L4.35 15.5c-.77.833.192 2.5 1.732 2.5z" />
                        </svg>
                    </div>
                    <div>
                        <h3 class="text-lg font-semibold text-gray-900">Supprimer cette annonce</h3>
                        <p class="text-sm text-gray-600">Action d'administrateur</p>
                    </div>
                </div>
                
                <div class="mb-6">
                    <p class="text-gray-700 mb-4">√ätes-vous s√ªr de vouloir supprimer cette annonce ?</p>
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <div class="text-sm space-y-2">
                            <div><strong>Titre:</strong> <span id="modal-title"></span></div>
                            <div><strong>Propri√©taire:</strong> <span id="modal-owner"></span></div>
                            <div><strong>Email:</strong> <span id="modal-email"></span></div>
                        </div>
                    </div>
                    <p class="text-red-600 text-sm mt-3 font-medium">‚ö†Ô∏è Cette action est irr√©versible.</p>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeStaffDeleteModal()" class="flex-1 px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition">
                        Annuler
                    </button>
                    <button onclick="executeStaffDelete()" class="flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition">
                        Supprimer
                    </button>
                </div>
            </div>
        </div>
    </div>

    <footer class="bg-black text-white pt-12 pb-6 px-4 sm:px-6 lg:px-8">
        <div class="max-w-7xl mx-auto">
          <div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8">
       
            <div>
              <h3 class="text-base font-semibold mb-3">PRODUCT</h3>
              <ul class="space-y-1.5">
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">Home</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">Browse by State</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">My Account</a></li>
              </ul>
            </div>
      
            <div>
              <h3 class="text-base font-semibold mb-3">RESOURCES</h3>
              <ul class="space-y-1.5">
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">About</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">How It Works</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">FAQ</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">Testimonials</a></li>
              </ul>
            </div>
      
            <div>
              <h3 class="text-base font-semibold mb-3">LEGAL</h3>
              <ul class="space-y-1.5">
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">Privacy</a></li>
                <li><a href="#" class="text-gray-400 hover:text-white transition text-sm">Terms</a></li>
                <li><a href="{% url 'contact:contact' %}" class="text-gray-400 hover:text-white transition text-sm">Contact</a></li>
              </ul>
            </div>
      
           
            <div>
              <h3 class="text-base font-semibold mb-3">CONNECT</h3>
              <div class="flex space-x-3">
                <a href="#" class="text-gray-400 hover:text-white transition">
                  <span class="sr-only">Instagram</span>
                  <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741 0 8.333.014 7.053.072 2.695.272.273 2.69.073 7.052.014 8.333 0 8.741 0 12c0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24c3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98C15.668.014 15.259 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.881 1.44 1.44 0 000-2.881z"/>
                  </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-white transition">
                  <span class="sr-only">Facebook</span>
                  <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd"/>
                  </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-white transition">
                  <span class="sr-only">Twitter</span>
                  <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"/>
                  </svg>
                </a>
                <a href="#" class="text-gray-400 hover:text-white transition">
                  <span class="sr-only">Discord</span>
                  <svg class="h-5 w-5" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M20.317 4.37a19.791 19.791 0 00-4.885-1.515.074.074 0 00-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 00-5.487 0 12.64 12.64 0 00-.617-1.25.077.077 0 00-.079-.037A19.736 19.736 0 003.677 4.37a.07.07 0 00-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 00.031.057 19.9 19.9 0 005.993 3.03.078.078 0 00.084-.028c.462-.63.874-1.295 1.226-1.994a.076.076 0 00-.041-.106 13.107 13.107 0 01-1.872-.892.077.077 0 01-.008-.128 10.2 10.2 0 00.372-.292.074.074 0 01.077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 01.078.01c.12.098.246.198.373.292a.077.077 0 01-.006.127 12.299 12.299 0 01-1.873.892.077.077 0 00-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 00.084.028 19.839 19.839 0 006.002-3.03.077.077 0 00.032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 00-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.955-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/>
                  </svg>
                </a>
              </div>
            </div>
          </div>
      
          <div class="border-t border-gray-800 pt-4 text-center text-gray-400 text-xs">
            <div class="flex flex-col md:flex-row justify-center items-center space-y-1 md:space-y-0 md:space-x-4">
              <a href="#" class="hover:text-white transition">Privacy Policy</a>
              <a href="#" class="hover:text-white transition">Terms of Service</a>
              <span>¬© 2025 Ilias ahmed. All rights reserved.</span>
            </div>
          </div>
        </div>
    </footer>

    <script>
        // Enhanced Photo Gallery JavaScript
        class PhotoGallery {
            constructor() {
                this.currentImageIndex = 0;
                this.isLoading = false;
                
                this.initializeElements();
                this.bindEvents();
                this.setupKeyboardNavigation();
            }
            
            initializeElements() {
                this.mainImages = document.querySelectorAll('.gallery-main-image');
                this.thumbnails = document.querySelectorAll('.gallery-thumbnail');
                this.currentImageNumber = document.getElementById('current-image-number');
                this.prevBtn = document.getElementById('prev-image-btn');
                this.nextBtn = document.getElementById('next-image-btn');
                this.loadingOverlay = document.getElementById('image-loading');
                this.totalImages = this.mainImages.length;
            }
            
            bindEvents() {
                // Thumbnail clicks
                this.thumbnails.forEach((thumbnail, index) => {
                    thumbnail.addEventListener('click', () => {
                        if (!this.isLoading) {
                            this.showImage(index);
                        }
                    });
                });
                
                // Navigation buttons
                if (this.prevBtn) {
                    this.prevBtn.addEventListener('click', () => this.showPreviousImage());
                }
                if (this.nextBtn) {
                    this.nextBtn.addEventListener('click', () => this.showNextImage());
                }
                
                // Touch/swipe support for mobile
                let startX = null;
                const mainContainer = document.querySelector('.gallery-main-container');
                
                if (mainContainer) {
                    mainContainer.addEventListener('touchstart', (e) => {
                        startX = e.touches[0].clientX;
                    });
                    
                    mainContainer.addEventListener('touchend', (e) => {
                        if (startX === null) return;
                        
                        const endX = e.changedTouches[0].clientX;
                        const diffX = startX - endX;
                        
                        if (Math.abs(diffX) > 50) { // Minimum swipe distance
                            if (diffX > 0) {
                                this.showNextImage();
                            } else {
                                this.showPreviousImage();
                            }
                        }
                        
                        startX = null;
                    });
                }
            }
            
            setupKeyboardNavigation() {
                document.addEventListener('keydown', (e) => {
                    if (this.isLoading) return;
                    
                    switch(e.key) {
                        case 'ArrowLeft':
                            e.preventDefault();
                            this.showPreviousImage();
                            break;
                        case 'ArrowRight':
                            e.preventDefault();
                            this.showNextImage();
                            break;
                        case 'Home':
                            e.preventDefault();
                            this.showImage(0);
                            break;
                        case 'End':
                            e.preventDefault();
                            this.showImage(this.totalImages - 1);
                            break;
                    }
                });
            }
            
            showImage(index, animate = true) {
                if (index < 0 || index >= this.totalImages || index === this.currentImageIndex) {
                    return;
                }
                
                if (animate) {
                    this.startLoading();
                }
                
                // Hide current image
                this.mainImages[this.currentImageIndex].classList.add('hidden');
                this.mainImages[this.currentImageIndex].classList.remove('block');
                
                // Show new image
                setTimeout(() => {
                    this.mainImages[index].classList.remove('hidden');
                    this.mainImages[index].classList.add('block', 'fade-in');
                    
                    // Update thumbnails
                    this.updateThumbnails(index);
                    
                    // Update counter
                    if (this.currentImageNumber) {
                        this.currentImageNumber.textContent = index + 1;
                    }
                    
                    // Scroll thumbnail into view
                    this.scrollThumbnailIntoView(index);
                    
                    this.currentImageIndex = index;
                    
                    if (animate) {
                        setTimeout(() => this.stopLoading(), 200);
                    }
                    
                    // Remove fade-in class after animation
                    setTimeout(() => {
                        this.mainImages[index].classList.remove('fade-in');
                    }, 500);
                }, animate ? 150 : 0);
            }
            
            updateThumbnails(activeIndex) {
                this.thumbnails.forEach((thumbnail, index) => {
                    if (index === activeIndex) {
                        thumbnail.classList.add('active');
                    } else {
                        thumbnail.classList.remove('active');
                    }
                });
            }
            
            scrollThumbnailIntoView(index) {
                if (this.thumbnails[index]) {
                    this.thumbnails[index].scrollIntoView({
                        behavior: 'smooth',
                        block: 'nearest',
                        inline: 'center'
                    });
                }
            }
            
            showPreviousImage() {
                const newIndex = this.currentImageIndex > 0 
                    ? this.currentImageIndex - 1 
                    : this.totalImages - 1;
                this.showImage(newIndex);
            }
            
            showNextImage() {
                const newIndex = this.currentImageIndex < this.totalImages - 1 
                    ? this.currentImageIndex + 1 
                    : 0;
                this.showImage(newIndex);
            }
            
            startLoading() {
                this.isLoading = true;
                if (this.loadingOverlay) {
                    this.loadingOverlay.classList.remove('hidden');
                }
            }
            
            stopLoading() {
                this.isLoading = false;
                if (this.loadingOverlay) {
                    this.loadingOverlay.classList.add('hidden');
                }
            }
        }

        // User menu dropdown functionality
        const userMenuButton = document.getElementById('user-menu-button');
        const userDropdown = document.getElementById('user-dropdown');
        let isOpen = false;

        if (userMenuButton && userDropdown) {
            userMenuButton.addEventListener('click', () => {
                isOpen = !isOpen;
                
                if (isOpen) {
                    userDropdown.classList.remove('hidden');
                    setTimeout(() => {
                        userDropdown.classList.remove('opacity-0', 'scale-95');
                        userDropdown.classList.add('opacity-100', 'scale-100');
                    }, 10);
                } else {
                    userDropdown.classList.remove('opacity-100', 'scale-100');
                    userDropdown.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        userDropdown.classList.add('hidden');
                    }, 200);
                }
            });

            document.addEventListener('click', (event) => {
                if (!userMenuButton.contains(event.target)) {
                    userDropdown.classList.remove('opacity-100', 'scale-100');
                    userDropdown.classList.add('opacity-0', 'scale-95');
                    setTimeout(() => {
                        userDropdown.classList.add('hidden');
                        isOpen = false;
                    }, 200);
                }
            });
        }

        // Staff Delete Functionality
        let pendingDeleteId = null;

        function confirmStaffDelete(announcementId, title, owner, email) {
            pendingDeleteId = announcementId;
            
            // Populate modal with announcement details
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-owner').textContent = owner;
            document.getElementById('modal-email').textContent = email;
            
            // Show modal
            document.getElementById('staff-delete-modal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        function closeStaffDeleteModal() {
            document.getElementById('staff-delete-modal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            pendingDeleteId = null;
        }

        function executeStaffDelete() {
            if (!pendingDeleteId) return;
            
            // Redirect to the staff delete confirmation page
            window.location.href = `/user/staff-delete/${pendingDeleteId}/`;
        }

        // Toggle favorite functionality
        function toggleFavorite(element) {
            console.log('toggleFavorite called');
            
            const announcementId = element.getAttribute('data-announcement-id');
            console.log('Announcement ID:', announcementId);
            
            if (!announcementId) {
                console.error('No announcement ID found');
                showToast('Error: No announcement ID found', 'error');
                return;
            }
            
            // Disable button during request
            element.style.pointerEvents = 'none';
            element.style.opacity = '0.7';
            
            // Get CSRF token
            const csrfToken = getCookie('csrftoken');
            console.log('CSRF Token:', csrfToken ? 'Found' : 'Not found');
            
            if (!csrfToken) {
                showToast('Error: CSRF token not found', 'error');
                element.style.pointerEvents = 'auto';
                element.style.opacity = '1';
                return;
            }
            
            const url = `/user/toggle-favorite/${announcementId}/`;
            console.log('Sending request to:', url);
            
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': csrfToken,
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            })
            .then(response => {
                console.log('Response status:', response.status);
                if (!response.ok) {
                    if (response.status === 404) {
                        throw new Error('URL not found. Check your URL configuration.');
                    } else if (response.status === 403) {
                        throw new Error('Permission denied. Make sure you are logged in.');
                    } else {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                }
                return response.json();
            })
            .then(data => {
                console.log('Response data:', data);
                if (data.success) {
                    // Update heart icon and text
                    const svg = element.querySelector('svg');
                    const textSpan = element.querySelector('span');
                    
                    if (data.is_favorited) {
                        element.classList.remove('not-favorited');
                        element.classList.add('favorited');
                        // Replace with filled heart
                        svg.outerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
                                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09
                                     C13.09 3.81 14.76 3 16.5 3
                                     19.58 3 22 5.42 22 8.5
                                     c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>`;
                        textSpan.textContent = 'Remove from Favorites';
                        showToast('Added to favorites', 'success');
                    } else {
                        element.classList.remove('favorited');
                        element.classList.add('not-favorited');
                        // Replace with empty heart
                        svg.outerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 
                                     2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09
                                     C13.09 3.81 14.76 3 16.5 3
                                     19.58 3 22 5.42 22 8.5
                                     c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>`;
                        textSpan.textContent = 'Add to Favorites';
                        showToast('Removed from favorites', 'success');
                    }
                } else {
                    console.error('Server error:', data.message);
                    showToast(data.message || 'An error occurred', 'error');
                }
            })
            .catch(error => {
                console.error('Fetch error:', error);
                showToast(`Failed to update favorite: ${error.message}`, 'error');
            })
            .finally(() => {
                // Re-enable button
                element.style.pointerEvents = 'auto';
                element.style.opacity = '1';
            });
        }

        // Get CSRF token function
        function getCookie(name) {
            let cookieValue = null;
            
            // First, look in cookies
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            
            // Fallback: look in meta tags
            if (!cookieValue) {
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfToken) {
                    cookieValue = csrfToken.value;
                }
            }
            
            // Fallback: look in hidden inputs
            if (!cookieValue) {
                const csrfInput = document.querySelector('input[name="csrfmiddlewaretoken"]');
                if (csrfInput) {
                    cookieValue = csrfInput.value;
                }
            }
            
            return cookieValue;
        }

        // Toast notification functions
        function showToast(message, type = 'info', duration = 5000) {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };
            
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="closeToast(this)">&times;</button>
                <div class="toast-progress"></div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                closeToast(toast.querySelector('.toast-close'));
            }, duration);
        }

        function closeToast(closeButton) {
            const toast = closeButton.parentElement;
            toast.classList.remove('show');
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.parentElement.removeChild(toast);
                }
            }, 300);
        }

        // Quiz functionality
        const quizData = {
            'shared_room': [
                { text: "Combien de douches prenez-vous par semaine?", answers: ["Moins de 3", "3-5 fois", "5-7 fois", "Plus de 7 fois"] },
                { text: "√Ä quelle fr√©quence faites-vous le m√©nage?", answers: ["Tous les jours", "2-3 fois par semaine", "Une fois par semaine", "Moins d'une fois par semaine"] },
                { text: "Quel est votre rythme de sommeil?", answers: ["Couche-t√¥t (avant 22h)", "Entre 22h et minuit", "Apr√®s minuit", "Horaires irr√©guliers"] },
                { text: "Comment g√©rez-vous le frigo partag√©?", answers: ["Je marque clairement mes affaires", "Je partage tout", "Je garde tout dans ma chambre", "Je n'utilise pas le frigo commun"] },
                { text: "Votre attitude envers les invit√©s?", answers: ["J'aime avoir des amis souvent", "Occasionnellement avec accord", "Tr√®s rarement", "Jamais d'invit√©s"] }
            ],
            'single_room': [
                { text: "Quelle est votre tol√©rance au bruit?", answers: ["J'aime le silence complet", "Un peu de bruit c'est OK", "Je fais souvent du bruit", "Peu importe"] },
                { text: "√Ä quelle fr√©quence recevez-vous?", answers: ["Jamais", "Rarement", "1-2 fois par semaine", "Plus de 3 fois par semaine"] },
                { text: "Votre routine matinale?", answers: ["Douche longue", "Douche rapide", "Pas de douche le matin", "Variable"] },
                { text: "Votre utilisation de la cuisine?", answers: ["Je cuisine tous les jours", "3-4 fois par semaine", "1-2 fois par semaine", "Je ne cuisine pas"] },
                { text: "Votre attitude envers le m√©nage?", answers: ["Je nettoie tous les jours", "2-3 fois par semaine", "Une fois par semaine", "Quand c'est vraiment sale"] }
            ],
            'apartment': [
                { text: "Comment g√©rez-vous les charges communes?", answers: ["Je paye ma part √† temps", "Je pr√©f√®re tout inclure dans le loyer", "Je n√©gocie toujours", "Je ne veux pas de charges"] },
                { text: "Votre style de d√©coration?", answers: ["Minimaliste", "Moderne", "Traditionnel", "Je ne d√©core pas"] },
                { text: "Votre utilisation des espaces communs?", answers: ["J'aime les partager √©quitablement", "Je pr√©f√®re avoir mes propres zones", "Je les utilise rarement", "Je veux tout l'espace pour moi"] },
                { text: "Votre tol√©rance aux animaux?", answers: ["J'adore les animaux", "Seulement certains animaux", "Seulement si tr√®s bien dress√©s", "Pas d'animaux"] },
                { text: "Votre attitude envers les r√®gles de l'appartement?", answers: ["Je les suis strictement", "Je suis flexible", "Je pr√©f√®re peu de r√®gles", "Je veux √©tablir mes propres r√®gles"] }
            ]
        };

        // Variables d'√©tat
        let currentQuestion = 0;
        let userAnswers = [];
        let quizType = 'shared_room';
        let quizQuestions = [];

        // √âl√©ments DOM
        const quizModal = document.getElementById('quiz-modal');
        const quizContainer = document.getElementById('quiz-container');
        const nextButton = document.getElementById('next-quiz-btn');
        const prevButton = document.getElementById('prev-quiz-btn');
        const progressBar = document.getElementById('progress-bar');
        const progressText = document.getElementById('progress-text');

        // D√©marrer le quiz
        const startQuizBtn = document.getElementById('start-quiz-btn');
        if (startQuizBtn) {
            startQuizBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // D√©tection du type d'annonce
                const roomTypeElements = Array.from(document.querySelectorAll('span')).filter(span => 
                    span.textContent.includes('Room Type')
                );
                
                if (roomTypeElements.length > 0) {
                    const roomTypeText = roomTypeElements[0].querySelector('strong').textContent.toLowerCase();
                    if (roomTypeText.includes('shared')) {
                        quizType = 'shared_room';
                    } else if (roomTypeText.includes('single')) {
                        quizType = 'single_room';
                    } else {
                        quizType = 'apartment';
                    }
                }
                
                // Get questions for this quiz type
                quizQuestions = quizData[quizType] || quizData['shared_room'];
                
                // R√©initialisation du quiz
                currentQuestion = 0;
                userAnswers = [];
                showQuestion();
                
                // Affichage du modal
                quizModal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            });
        }

        // Fermer le quiz
        document.getElementById('close-quiz').addEventListener('click', function() {
            quizModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
         
        });

        // Afficher une question
        function showQuestion() {
            const question = quizQuestions[currentQuestion];

            progressBar.style.width = `${(currentQuestion + 1) / quizQuestions.length * 100}%`;
            progressText.textContent = `Question ${currentQuestion + 1}/${quizQuestions.length}`;

            prevButton.classList.toggle('hidden', currentQuestion === 0);
            nextButton.textContent = currentQuestion === quizQuestions.length - 1 ? 'Terminer' : 'Suivant';

            let html = `
                <div class="question-container">
                    <h4 class="text-lg font-medium text-gray-800 mb-4">${question.text}</h4>
                    <div class="space-y-3">
            `;

            question.answers.forEach((answer, index) => {
                const isChecked = userAnswers[currentQuestion] === index;
                html += `
                    <label class="flex items-center p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition ${isChecked ? 'border-blue-500 bg-blue-50' : ''}">
                        <input type="radio" name="answer" value="${index}" class="hidden" ${isChecked ? 'checked' : ''}>
                        <span class="flex-1">${answer}</span>
                        <div class="w-5 h-5 border-2 rounded-full border-gray-300 flex items-center justify-center ml-3 ${isChecked ? 'border-blue-500' : ''}">
                            ${isChecked ? '<div class="w-3 h-3 bg-blue-500 rounded-full"></div>' : ''}
                        </div>
                    </label>
                `;
            });

            html += `</div></div>`;
            quizContainer.innerHTML = html;

            // Ajoutez les √©couteurs d'√©v√©nements apr√®s l'insertion du HTML
            document.querySelectorAll('input[name="answer"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    userAnswers[currentQuestion] = parseInt(this.value);
                    // Mettez √† jour les styles visuels
                    document.querySelectorAll('label').forEach(label => {
                        label.classList.remove('border-blue-500', 'bg-blue-50');
                        const radioInput = label.querySelector('input[type="radio"]');
                        const customRadio = label.querySelector('div > div');
                        if (radioInput.checked) {
                            label.classList.add('border-blue-500', 'bg-blue-50');
                            if (customRadio) customRadio.classList.add('bg-blue-500');
                        } else {
                            if (customRadio) customRadio.classList.remove('bg-blue-500');
                        }
                    });
                });
            });
        }

        // Navigation
        nextButton.addEventListener('click', function() {
            if (userAnswers[currentQuestion] === undefined) {
                showToast('Veuillez s√©lectionner une r√©ponse', 'warning');
                return;
            }

            if (currentQuestion < quizQuestions.length - 1) {
                currentQuestion++;
                animateQuestionTransition('next');
            } else {
                finishQuiz();
            }
        });

        prevButton.addEventListener('click', function() {
            currentQuestion--;
            animateQuestionTransition('prev');
        });

        // Transition anim√©e
        function animateQuestionTransition(direction) {
            const questionContainer = document.querySelector('.question-container');
            if (questionContainer) {
                questionContainer.style.opacity = '0';
                questionContainer.style.transform = direction === 'next' ? 'translateX(50px)' : 'translateX(-50px)';
                questionContainer.style.transition = 'all 0.3s ease';

                setTimeout(() => {
                    showQuestion();
                    const newQuestion = document.querySelector('.question-container');
                    newQuestion.style.opacity = '0';
                    newQuestion.style.transform = direction === 'next' ? 'translateX(-50px)' : 'translateX(50px)';

                    setTimeout(() => {
                        newQuestion.style.opacity = '1';
                        newQuestion.style.transform = 'translateX(0)';
                    }, 50);
                }, 300);
            }
        }

        // Fin du quiz
        function finishQuiz() {
            console.log('Quiz termin√©! R√©ponses:', userAnswers);
            console.log('Quiz Type:', quizType);
            console.log('Questions:', quizQuestions);

            // Prepare quiz data for submission
            const quizSubmissionData = {
                quiz_type: quizType,
                questions: quizQuestions,
                answers: userAnswers.map((answerIndex, questionIndex) => ({
                    question_index: questionIndex,
                    answer_index: answerIndex,
                    answer_text: quizQuestions[questionIndex].answers[answerIndex]
                }))
            };

            // Get CSRF token
            const csrfToken = getCookie('csrftoken');
            if (!csrfToken) {
                showToast('Erreur lors de l\'envoi du quiz: Token CSRF manquant', 'error');
                return;
            }

            // Submit quiz to server
            const announcementId = {{ announcement.id }};
            fetch(`/user/submit-quiz/${announcementId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken,
                    'X-Requested-With': 'XMLHttpRequest'
                },
                body: JSON.stringify(quizSubmissionData)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    // Construct the conversation URL using the conversation_id from the response
                    const conversationUrl = data.conversation_id ? 
                        `/messaging/conversation/${data.conversation_id}/` : 
                        '/messaging/';
                    
                    // Show success message
                    quizContainer.innerHTML = `
                        <div class="text-center py-8">
                            <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                            </div>
                            <h4 class="text-xl font-medium text-gray-800 mb-2">Quiz envoy√© avec succ√®s!</h4>
                            <p class="text-gray-600">Vos r√©ponses ont √©t√© transmises au propri√©taire.</p>
                            <p class="text-gray-600 mt-2">Une conversation a √©t√© cr√©√©e pour vous.</p>
                            <div class="mt-6 space-y-3">
                                
                                <button id="close-quiz-btn" class="w-full px-6 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50 transition" onclick="location.reload()">
    Fermer
</button>
                            </div>
                        </div>
                    `;

                    document.getElementById('close-quiz-btn').addEventListener('click', function() {
                        quizModal.classList.add('hidden');
                        document.body.style.overflow = 'auto';
                    });

                    prevButton.classList.add('hidden');
                    nextButton.classList.add('hidden');
                } else {
                    throw new Error(data.error || 'Erreur inconnue');
                }
            })
            .catch(error => {
                console.error('Error submitting quiz:', error);
                showToast('Erreur lors de l\'envoi du quiz: ' + error.message, 'error');
            });
        }
        
        // Initialize gallery when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            new PhotoGallery();
        });

        // Handle Django messages
        {% if messages %}
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(function() {
                {% for message in messages %}
                    showToast('{{ message|escapejs }}', '{{ message.tags }}');
                {% endfor %}
            }, 100);
        });
        {% endif %}
    </script>
    <script>
// Store announcement ID for quiz submission
const announcementId = {{ announcement.id }};

// Updated JavaScript to handle quiz completion check
function startQuiz() {
    // Your existing quiz start logic here
    console.log('Starting quiz for announcement:', announcementId);
    // Add your quiz modal or navigation logic here
}

// Handle login required for non-authenticated users
function loginRequired() {
    window.location.href = "{% url 'pages:login' %}";
}

// Handle quiz submission with completion check
function submitQuiz(quizData) {
    fetch(`/submit-quiz/${announcementId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken')
        },
        body: JSON.stringify(quizData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert(data.message);
            // Redirect to conversation using the correct URL pattern
            const conversationUrl = data.conversation_id ? 
                `/messaging/conversation/${data.conversation_id}/` : 
                '/messaging/';
            window.location.href = conversationUrl;
        } else {
            if (data.already_completed) {
                // Disable the button and change appearance
                const quizBtn = document.querySelector('.quiz-btn');
                if (quizBtn) {
                    quizBtn.className = 'quiz-btn-disabled w-full flex items-center justify-center space-x-2 font-semibold py-4 px-6 rounded-xl transition-colors duration-200';
                    quizBtn.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Quiz D√©j√† Compl√©t√©</span>
                    `;
                    quizBtn.disabled = true;
                    quizBtn.onclick = null;
                }
            }
            alert(data.error);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while submitting the quiz.');
    });
}
</script>
</body>
</html>